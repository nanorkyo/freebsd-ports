From 5700d989cc18889e1601c651ad69a41af8b32073 Mon Sep 17 00:00:00 2001
From: Markus Rickert <markus.rickert@uni-bamberg.de>
Date: Wed, 18 Jun 2025 13:48:55 +0200
Subject: [PATCH] Fix CMake iconv handling after change to private dependency

---
 CMakeLists.txt          | 2 +-
 libxml2-config.cmake.in | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index e136f2167..b952d7bfa 100644
--- CMakeLists.txt
+++ CMakeLists.txt
@@ -354,7 +354,7 @@ if(WIN32)
 endif()
 
 if(LIBXML2_WITH_ICONV)
-    target_link_libraries(LibXml2 PUBLIC Iconv::Iconv)
+    target_link_libraries(LibXml2 PRIVATE Iconv::Iconv)
     if(NOT Iconv_IS_BUILT_IN)
         set(ICONV_LIBS "-liconv")
     endif()
diff --git a/libxml2-config.cmake.in b/libxml2-config.cmake.in
index e040a759b..3ce7ef43f 100644
--- libxml2-config.cmake.in
+++ libxml2-config.cmake.in
@@ -56,7 +56,7 @@ if(NOT LIBXML2_SHARED)
     if(LIBXML2_WITH_ICONV)
         find_dependency(Iconv)
         list(APPEND LIBXML2_LIBRARIES    ${Iconv_LIBRARIES})
-        list(APPEND LIBXML2_INTERFACE_LINK_LIBRARIES "Iconv::Iconv")
+        list(APPEND LIBXML2_INTERFACE_LINK_LIBRARIES "\$<LINK_ONLY:Iconv::Iconv>")
         if(NOT Iconv_FOUND)
             set(${CMAKE_FIND_PACKAGE_NAME}_FOUND FALSE)
             set(${CMAKE_FIND_PACKAGE_NAME}_NOT_FOUND_MESSAGE "Iconv dependency was not found")
-- 
GitLab

